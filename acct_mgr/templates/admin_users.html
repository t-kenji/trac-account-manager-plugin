<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/" 
      xmlns:i18n="http://genshi.edgewall.org/i18n"
      i18n:domain="acct_mgr">
  <xi:include href="admin.html" />
  <head>
    <title>Accounts</title>
  </head>

  <body>
    <h2>Manage User Accounts</h2>

    <form id="addaccount" class="addnew" method="post"
          py:if="create_enabled">
      <fieldset>
        <div class="system-message" py:if="registration_error">
          <p>${registration_error}</p>
        </div>
        <div class="system-message" py:if="password_change_error">
          <p>${password_change_error}</p>
        </div>
        <div class="notice system-message" py:if="success">
          <p i18n:msg="success">
            Successfully updated: ${', '.join(success)}
          </p>
        </div>

        <legend>Add/Edit Account:</legend>
        <div class="field">
          <label>Username: 
            <input type="text" name="username" id="username"
                   class="textwidget" value="${account.username}" /></label>
        </div>
        <div class="field">
          <label>Password: 
            <input type="password" name="password"
                   class="textwidget" /></label>
        </div>
        <div class="field">
          <label>Confirm Password: 
            <input type="password" name="password_confirm"
                   class="textwidget" /></label>
        </div>
        <div class="field">
          <label>Pre-/Surname (Nickname): 
            <input type="text" name="name" class="textwidget"
                   value="${account.name}" /></label>
        </div>
        <div class="field">
          <label>Email Address: 
            <input type="text" name="email" class="textwidget"
                   value="${account.email}" /></label>
        </div>
        <p class="help">Add a new user account or edit an existing one.</p>
        <div class="buttons">
          <input type="submit" name="add"
                 value="${dgettext('acct_mgr', ' Add ')}" />
          <input type="submit" name="change"
                 value="${dgettext('acct_mgr', ' Change ')}" />
        </div>
      </fieldset>
    </form>

    <py:choose>
    <div class="system-message"
         py:when="not listing_enabled">
      <p>This password store does not support listing users.</p>
    </div>
    <form method="post" py:otherwise="" py:strip="not delete_enabled">
      <div class="system-message"
           py:if="deletion_error"><p>${deletion_error}</p></div>
      <div id="accountlist">
        <table class="listing" id="accountlist">
          <thead>
            <tr>
              <th class="sel" py:if="delete_enabled">&nbsp;</th>
              <th>Account</th><th>Name</th><th>Email</th><th>Last Login</th>
            </tr>
          </thead>
          <tbody>
            <tr py:for="acct in accounts">
              <td py:if="delete_enabled">
                <input type="checkbox" name="sel"
                       value="${acct.username}" />
              </td>
              <td>${acct.username}
                <py:choose py:if="acct.locked">
                  <a href="${acct.review_url}"
                     py:when="acct.release_hint"
                     title="${acct.release_hint}">
                    <img src="${href.chrome('/acct_mgr/time-locked.png')}" />
                  </a>
                  <a href="${acct.review_url}" py:otherwise=""
                     title="${dgettext('acct_mgr', 'Permanently locked')}">
                    <img src="${href.chrome('/acct_mgr/locked.png')}" />
                  </a>
                </py:choose>
              </td>
              <td>${acct.name}</td>
              <td>${acct.email}</td>
              <td>${acct.last_visit}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="buttons">
        <input type="submit" name="reset"
               py:if="password_reset_enabled"
               value="${dgettext('acct_mgr', 'Reset passwords')}" />
        <input type="submit" name="remove"
               py:if="delete_enabled"
               value="${dgettext('acct_mgr', 'Remove selected accounts')}" />
      </div>
    </form>
    </py:choose>
  </body>
</html>
